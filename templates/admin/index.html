{% load i18n static %}
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/svg+xml" href="{% static 'argon-dashboard-master/assets/img/favicon-admin.svg' %}?v=3">
  <title>VN-Travel Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="{% static 'argon-dashboard-master/assets/css/argon-dashboard.css' %}">
  <style>
    /* small navbar separator between links */
    .nav-separator { width:1px; height:28px; background: rgba(255,255,255,0.18); margin: 0 12px; border-radius:2px; }
    .navbar .nav-link { color: rgba(255,255,255,0.92); }
    
    /* Model Badge Styling */
    .model-link {
      margin: 2px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .model-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    /* Content Fade Animation */
    .fade-in {
      animation: fadeIn 0.4s ease-in;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Loading Spinner */
    .custom-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(99, 102, 241, 0.2);
      border-top-color: #6366f1;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Loading container */
    .loading-container {
      background: linear-gradient(135deg, #f8f9fc 0%, #ffffff 100%);
      border-radius: 12px;
      padding: 60px 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .loading-container p {
      color: #4a5568;
    }
    
    /* Back Button */
    #back-to-list {
      transition: all 0.3s ease;
    }
    
    #back-to-list:hover {
      transform: translateX(-3px);
      box-shadow: 0 4px 8px rgba(94, 114, 228, 0.3);
    }
    
    /* Card transitions */
    #app-list-body {
      transition: all 0.3s ease;
      min-height: 200px;
    }
    
    /* Inline content styling */
    .inline-content {
      background: #fff;
      border-radius: 12px;
      padding: 0;
      box-shadow: none;
    }
    
    /* Card Stats - Force White Background */
    .card-stats {
      background-color: #ffffff !important;
      background-image: none !important;
      background: #ffffff !important;
    }
    
    /* Clean up Django admin elements inside inline content */
    .inline-content #content-main {
      padding: 0;
      margin: 0;
    }

    /* Compact sidenav so all items fit without scrolling */
    #sidenav-main {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    #sidenav-main .navbar-brand {
      padding: 4px 8px;
    }

    #sidenav-main .navbar-brand img {
      width: 24px;
      height: 24px;
    }

    #sidenav-main .navbar-brand span {
      font-size: 14px;
    }

    #sidenav-main .navbar-nav h6 {
      margin: 4px 0 2px 0;
      letter-spacing: 0.35px;
      font-size: 9px;
    }

    #sidenav-main .navbar-nav .nav-item .nav-link {
      padding: 5px 9px;
      margin: 0;
      line-height: 1.05;
      min-height: 30px;
    }

    #sidenav-main .navbar-nav .nav-item .icon {
      width: 26px;
      height: 26px;
    }

    #sidenav-main .navbar-nav .nav-link .nav-link-text {
      font-size: 12.5px;
    }

    #sidenav-main .sidenav-footer {
      padding-top: 4px;
      padding-bottom: 4px;
    }

    #sidenav-main #sidenavCard {
      background: #f8fbff;
      border-radius: 10px;
      padding: 6px 6px 4px 6px;
      margin-bottom: 6px;
    }

    #sidenav-main #sidenavCard img {
      width: 28px;
    }

    #sidenav-main #sidenavCard .card-body {
      padding: 4px 4px 2px 4px;
    }

    #sidenav-main #sidenavCard h6 {
      margin-bottom: 1px;
      font-size: 11px;
    }

    #sidenav-main #sidenavCard p {
      margin-bottom: 2px;
      font-size: 10px;
    }

    #sidenav-main .btn {
      padding: 7px 9px;
      font-size: 12px;
    }
    
    .inline-content #content-main > h1 {
      display: none; /* Hide "Select Tour to change" title */
    }
    
    .inline-content .breadcrumbs {
      display: none; /* Hide breadcrumbs in inline view */
    }
    
    /* Style object-tools (Add button) */
    .inline-content .object-tools {
      padding: 20px 20px 10px 20px;
      margin: 0;
      border-bottom: 2px solid #f1f3f7;
      background: linear-gradient(to bottom, #fafbfc 0%, #ffffff 100%);
    }
    
    .inline-content .object-tools li {
      margin: 0;
    }
    
    .inline-content .object-tools a {
      background: linear-gradient(135deg, #2dce89 0%, #2dcecc 100%) !important;
      color: white !important;
      padding: 10px 20px !important;
      border-radius: 8px !important;
      font-weight: 600 !important;
      font-size: 13px !important;
      box-shadow: 0 4px 12px rgba(45, 206, 137, 0.3) !important;
      transition: all 0.2s ease !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
      border: none !important;
    }
    
    .inline-content .object-tools a:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(45, 206, 137, 0.4) !important;
    }
    
    /* Style changelist */
    .inline-content #changelist {
      padding: 20px;
      background: transparent;
    }
    
    /* Toolbar (Search bar) */
    .inline-content #toolbar {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
    }
    
    .inline-content #changelist-search {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .inline-content #changelist-search input[type="text"] {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .inline-content #changelist-search input[type="text"]:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }
    
    .inline-content #changelist-search label {
      margin: 0;
      display: flex;
      align-items: center;
    }
    
    .inline-content #changelist-search label img {
      width: 20px;
      height: 20px;
      opacity: 0.5;
    }
    
    /* Actions */
    .inline-content .actions {
      background: #fff;
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .inline-content .actions label {
      margin: 0;
      font-weight: 600;
      color: #4a5568;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .inline-content .actions select {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .inline-content .actions select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }
    
    .inline-content .action-counter {
      font-size: 13px;
      color: #8898aa;
      font-weight: 500;
      margin-left: auto;
    }
    
    /* Results table */
    .inline-content .results {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      overflow: hidden;
      margin: 0;
    }
    
    /* Table styling in inline view */
    .inline-content #result_list {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    .inline-content #result_list thead th {
      background: linear-gradient(to bottom, #f8f9fc 0%, #f1f3f7 100%);
      color: #4a5568;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 11px;
      letter-spacing: 0.5px;
      padding: 16px 12px;
      border-bottom: 2px solid #e2e8f0;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .inline-content #result_list thead th a {
      color: #4a5568;
      text-decoration: none;
      font-weight: 700;
    }
    
    .inline-content #result_list thead th a:hover {
      color: #6366f1;
    }
    
    .inline-content #result_list tbody tr {
      border-bottom: 1px solid #f1f3f7;
      transition: all 0.2s ease;
    }
    
    .inline-content #result_list tbody tr:hover {
      background: #fafbfe;
      transform: scale(1.001);
    }
    
    .inline-content #result_list tbody td,
    .inline-content #result_list tbody th {
      padding: 14px 12px;
      vertical-align: middle;
    }
    
    .inline-content #result_list tbody th a {
      color: #6366f1;
      font-weight: 600;
      text-decoration: none;
      border-bottom: 1px dashed #6366f1;
      transition: all 0.2s ease;
    }
    
    .inline-content #result_list tbody th a:hover {
      color: #5558e3;
      border-bottom-style: solid;
    }
    
    .inline-content #result_list tbody td img {
      vertical-align: middle;
    }
    
    /* Paginator */
    .inline-content .paginator {
      margin-top: 20px;
      padding: 15px 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      text-align: center;
      font-weight: 600;
      color: #4a5568;
    }
    
    /* Change Form Styling */
    .inline-content form#changelist-form {
      /* Remove default margins */
    }
    
    .inline-content fieldset {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 20px;
      margin-bottom: 20px;
      border: none;
    }
    
    .inline-content fieldset h2 {
      background: linear-gradient(to bottom, #f8f9fc 0%, #f1f3f7 100%);
      color: #4a5568;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.5px;
      padding: 12px 20px;
      margin: -20px -20px 20px -20px;
      border-radius: 10px 10px 0 0;
    }
    
    .inline-content .form-row {
      padding: 12px 0;
      border-bottom: 1px solid #f1f3f7;
    }
    
    .inline-content .form-row:last-child {
      border-bottom: none;
    }
    
    .inline-content .form-row label {
      font-weight: 600;
      color: #4a5568;
      font-size: 13px;
      margin-bottom: 6px;
      display: block;
    }
    
    .inline-content .form-row input,
    .inline-content .form-row select,
    .inline-content .form-row textarea {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .inline-content .form-row input:focus,
    .inline-content .form-row select:focus,
    .inline-content .form-row textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      outline: none;
    }
    
    /* Submit Row */
    .inline-content .submit-row {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      position: sticky;
      bottom: 20px;
      z-index: 100;
    }
    
    .inline-content .submit-row input[type="submit"],
    .inline-content .submit-row button {
      padding: 12px 24px !important;
      border-radius: 8px !important;
      font-weight: 600 !important;
      font-size: 14px !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      border: none !important;
    }
    
    .inline-content .submit-row input[name="_save"] {
      background: linear-gradient(135deg, #2dce89 0%, #2dcecc 100%) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(45, 206, 137, 0.3) !important;
    }
    
    .inline-content .submit-row input[name="_save"]:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(45, 206, 137, 0.4) !important;
    }
    
    .inline-content .submit-row input[name="_continue"] {
      background: linear-gradient(135deg, #6366f1 0%, #5558e3 100%) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3) !important;
    }
    
    .inline-content .submit-row input[name="_continue"]:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4) !important;
    }
    
    .inline-content .submit-row .deletelink {
      background: linear-gradient(135deg, #f5365c 0%, #f56036 100%) !important;
      color: white !important;
      box-shadow: 0 4px 12px rgba(245, 54, 92, 0.3) !important;
      padding: 12px 24px !important;
      border-radius: 8px !important;
      text-decoration: none !important;
      display: inline-block !important;
      font-weight: 600 !important;
    }
    
    .inline-content .submit-row .deletelink:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(245, 54, 92, 0.4) !important;
    }
    
    /* Help text */
    .inline-content .help,
    .inline-content .helptext {
      font-size: 12px;
      color: #8898aa;
      margin-top: 4px;
      display: block;
    }
    
    /* Errors */
    .inline-content .errorlist {
      background: #fff5f5;
      color: #f5365c;
      padding: 8px 12px;
      border-radius: 6px;
      border-left: 3px solid #f5365c;
      margin: 8px 0;
      font-size: 13px;
    }
    
    /* Card body padding adjustment */
    #app-list-card .card-body {
      padding: 0 !important;
    }
    
    /* Card styling - keep original header style */
    #app-list-card .card {
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      border: none;
      overflow: hidden;
    }
    
    #app-list-card .card-header {
      background: #fff;
      padding: 20px 24px;
      border-bottom: 1px solid #f1f3f7;
    }
    
    #app-list-card .card-header h6 {
      color: #525f7f;
      font-weight: 600;
      font-size: 16px;
      margin: 0;
    }
    
    /* Purple Button Styling for Search and Go buttons */
    button[type="submit"],
    input[type="submit"],
    .btn-primary,
    button.btn-primary,
    a.btn-primary {
      background: linear-gradient(135deg, #6366f1 0%, #5558e3 100%) !important;
      border: none !important;
      color: white !important;
      border-radius: 6px !important;
      padding: 8px 20px !important;
      font-weight: 600 !important;
      font-size: 13px !important;
      cursor: pointer !important;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25) !important;
      transition: all 0.2s ease !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
    }
    
    button[type="submit"]:hover,
    input[type="submit"]:hover,
    .btn-primary:hover,
    button.btn-primary:hover,
    a.btn-primary:hover {
      background: linear-gradient(135deg, #5558e3 0%, #4950d1 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35) !important;
      color: white !important;
    }
    
    /* Gray Go button to Purple */
    button[value="Go"],
    input[value="Go"],
    .actions button,
    .actions input[type="submit"] {
      background: linear-gradient(135deg, #6366f1 0%, #5558e3 100%) !important;
      border: none !important;
      color: white !important;
      border-radius: 6px !important;
      padding: 8px 20px !important;
      font-weight: 600 !important;
      cursor: pointer !important;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25) !important;
      transition: all 0.2s ease !important;
    }
    
    button[value="Go"]:hover,
    input[value="Go"]:hover,
    .actions button:hover,
    .actions input[type="submit"]:hover {
      background: linear-gradient(135deg, #5558e3 0%, #4950d1 100%) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(99, 102, 241, 0.35) !important;
    }
    
    /* Hide Filter completely */
    #changelist-filter,
    .changelist-filter,
    #content-main #changelist-filter,
    .inline-content #changelist-filter,
    aside.changelist-filter-aside {
      display: none !important;
      visibility: hidden !important;
    }
    
    /* Make changelist full width when filter is hidden */
    #changelist .results,
    .inline-content #changelist .results {
      margin-right: 0 !important;
      width: 100% !important;
    }
    
    #changelist,
    .inline-content #changelist {
      padding-right: 0 !important;
    }
  </style>
</head>

<body class="g-sidenav-show bg-gray-100">
  <div class="min-height-300 bg-dark position-absolute w-100"></div>
  
  <!-- Sidebar -->
  <aside class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4" id="sidenav-main">
    <div class="sidenav-header">
      <a class="navbar-brand m-0 d-flex align-items-center" href="{% url 'admin:index' %}">
        <img src="{% static 'argon-dashboard-master/assets/img/theme/logoVN-Travel.png' %}" alt="VN-Travel" class="navbar-brand-img h-100" style="width:34px; height:34px; object-fit:contain;">
        <span class="ms-2 font-weight-bold" style="color: #11cdef; font-size: 18px;">VN-Travel</span>
      </a>
    </div>
    <hr class="horizontal dark mt-0">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link active" href="{% url 'admin:index' %}">
            <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
              <i class="ni ni-tv-2 text-dark text-sm opacity-10"></i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>
        
        {% for app in app_list %}
          {% if app.models %}
            <li class="nav-item mt-3">
              <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder opacity-6">{{ app.name|upper }}</h6>
            </li>
            {% for model in app.models %}
              <li class="nav-item">
                <a class="nav-link" href="{% if model.admin_url %}{{ model.admin_url }}{% endif %}">
                  <div class="icon icon-shape icon-sm border-radius-md text-center me-2 d-flex align-items-center justify-content-center">
                    <i class="ni ni-collection text-dark text-sm opacity-10"></i>
                  </div>
                  <span class="nav-link-text ms-1">{{ model.name }}</span>
                </a>
              </li>
            {% endfor %}
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    <div class="sidenav-footer mx-3">
      <div class="card card-plain shadow-none" id="sidenavCard">
        <img class="w-50 mx-auto" src="{% static 'argon-dashboard-master/assets/img/illustrations/icon-documentation.svg' %}" alt="sidebar_illustration">
        <div class="card-body text-center p-3 w-100 pt-0">
          <div class="docs-info">
            <h6 class="mb-0">{% trans "C·∫ßn gi√∫p?" %}</h6>
            <p class="text-xs font-weight-bold mb-0">{% trans "Xem t√†i li·ªáu" %}</p>
          </div>
        </div>
      </div>
      <a href="{% url 'admin:logout' %}" class="btn btn-dark btn-sm w-100 mb-3">{% trans "Tho√°t" %}</a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content position-relative border-radius-lg">
    <!-- Navbar -->
    <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur" data-scroll="false">
      <div class="container-fluid py-1 px-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
            <li class="breadcrumb-item text-sm"><a class="opacity-5 text-white" href="javascript:;">Admin</a></li>
            <li class="breadcrumb-item text-sm text-white active" aria-current="page">Dashboard</li>
          </ol>
          <h6 class="font-weight-bolder text-white mb-0">{% trans "Dashboard" %}</h6>
        </nav>
        <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
          <ul class="navbar-nav ms-auto justify-content-end">
            <li class="nav-item d-flex align-items-center">
              <a href="/" class="nav-link text-white font-weight-bold px-0">
                <i class="fa fa-globe me-sm-1"></i>
                <span class="d-sm-inline d-none">{% trans "Trang ch·ªß" %}</span>
              </a>
            </li>
            <li class="nav-item d-flex align-items-center">
              <div class="nav-separator d-none d-md-block" aria-hidden="true"></div>
            </li>
            <li class="nav-item d-flex align-items-center">
              <a href="http://127.0.0.1:8000/admin/password_change/" class="nav-link text-white font-weight-bold px-0">
                <i class="fa fa-lock me-sm-1"></i>
                <span class="d-sm-inline d-none">{% trans "ƒê·ªïi m·∫≠t kh·∫©u" %}</span>
              </a>
            </li>
            <li class="nav-item dropdown pe-2 d-flex align-items-center">
              <a href="javascript:;" class="nav-link text-white p-0" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa fa-user-circle fa-2x"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
                <li class="mb-2">
                  <a class="dropdown-item border-radius-md" href="javascript:;">
                    <div class="d-flex py-1">
                      <div class="d-flex flex-column justify-content-center">
                        <h6 class="text-sm font-weight-normal mb-1">
                          <span class="font-weight-bold">{{ request.user.get_full_name|default:request.user.username }}</span>
                        </h6>
                        <p class="text-xs text-secondary mb-0">Admin</p>
                      </div>
                    </div>
                  </a>
                </li>
                <li class="border-top"></li>
                <li class="mt-2">
                  <a class="dropdown-item border-radius-md" href="{% url 'admin:logout' %}">
                    <i class="fa fa-sign-out me-2"></i>
                    {% trans "ƒêƒÉng xu·∫•t" %}
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->

    <!-- Content -->
    <div class="container-fluid py-4">
      {# total_models is computed in the view and passed in context #}
        <!-- Stats Row -->
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold">{% trans "·ª®ng d·ª•ng" %}</p>
                      <h5 class="font-weight-bolder">{{ app_list|length }}</h5>
                      <p class="mb-0"><span class="text-success text-sm font-weight-bolder">{% trans "T·ªïng c·ªông" %}</span></p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-folder-17 text-lg opacity-10"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold">{% trans "Model" %}</p>
                      <h5 class="font-weight-bolder">{{ total_models }}</h5>
                      <p class="mb-0"><span class="text-success text-sm font-weight-bolder">{% trans "T·ªïng c·ªông" %}</span></p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                      <i class="ni ni-collection text-lg opacity-10"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold">{% trans "Ng∆∞·ªùi d√πng" %}</p>
                      <h5 class="font-weight-bolder">{{ request.user.get_short_name|default:request.user.username }}</h5>
                      <p class="mb-0"><span class="text-success text-sm font-weight-bolder">{% trans "ƒê√£ ƒëƒÉng nh·∫≠p" %}</span></p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                      <i class="ni ni-single-02 text-lg opacity-10"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6">
            <div class="card">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold">{% trans "Tr·∫°ng th√°i" %}</p>
                      <h5 class="font-weight-bolder">{% trans "Ho·∫°t ƒë·ªông" %}</h5>
                      <p class="mb-0"><span class="text-success text-sm font-weight-bolder">üü¢ Online</span></p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                      <i class="ni ni-check-bold text-lg opacity-10"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Dashboard Statistics -->
        <div class="row mt-4">
          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card card-stats" style="background-color: #fff !important; border: none !important; box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important; border-radius: 12px !important;">
              <div class="card-body p-3" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                  <p class="text-secondary text-sm mb-2" style="color: #8898aa; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Tours</p>
                  <h4 class="mb-0" style="color: #32325d; font-weight: 700; font-size: 28px;">{{ stats.tours.total }}</h4>
                  <p class="text-success mb-0 mt-2" style="font-size: 14px; font-weight: 700;">
                    ‚úàÔ∏è {{ stats.tours.active }} ho·∫°t ƒë·ªông
                  </p>
                </div>
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #11cdef 0%, #11cdef 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; flex-shrink: 0;">
                   <i class="ni ni-compass-04"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card card-stats" style="background-color: #fff !important; border: none !important; box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important; border-radius: 12px !important;">
              <div class="card-body p-3" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                  <p class="text-secondary text-sm mb-2" style="color: #8898aa; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">ƒê·∫∑t Tour</p>
                  <h4 class="mb-0" style="color: #32325d; font-weight: 700; font-size: 28px;">{{ stats.bookings.total }}</h4>
                  <p class="text-success mb-0 mt-2" style="font-size: 14px; font-weight: 700;">
                    <i class="ni ni-check-bold"></i> {{ stats.bookings.confirmed }} x√°c nh·∫≠n
                  </p>
                </div>
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #2dce89 0%, #2dce89 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; flex-shrink: 0;">
                  <i class="ni ni-calendar-grid-58"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card card-stats" style="background-color: #fff !important; border: none !important; box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important; border-radius: 12px !important;">
              <div class="card-body p-3" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                  <p class="text-secondary text-sm mb-2" style="color: #8898aa; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">Thanh To√°n</p>
                  <h4 class="mb-0" style="color: #32325d; font-weight: 700; font-size: 28px;">{{ stats.payments.total }}</h4>
                  <p class="text-success mb-0 mt-2" style="font-size: 14px; font-weight: 700;">
                    <i class="ni ni-like-2"></i> {{ stats.payments.paid }} th√†nh c√¥ng
                  </p>
                </div>
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #fb6340 0%, #fb6340 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; flex-shrink: 0;">
                  <i class="ni ni-credit-card"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
            <div class="card card-stats" style="background-color: #fff !important; border: none !important; box-shadow: 0 4px 20px rgba(0,0,0,0.08) !important; border-radius: 12px !important;">
              <div class="card-body p-3" style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                  <p class="text-secondary text-sm mb-2" style="color: #8898aa; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">T√†i kho·∫£n</p>
                  <h4 class="mb-0" style="color: #32325d; font-weight: 700; font-size: 28px;">{{ stats.users }}</h4>
                  <p class="text-primary mb-0 mt-2" style="font-size: 14px; font-weight: 700;">
                    <i class="ni ni-badge"></i> T√†i kho·∫£n
                  </p>
                </div>
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #6366f1 0%, #6366f1 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; flex-shrink: 0;">
                  <i class="ni ni-circle-08"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Revenue Card -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="card" style="box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
              <div class="card-header pb-0 pt-4 d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between">
                <div>
                  <h6 style="color: #32325d; font-weight: 700;">Doanh Thu</h6>
                  <p class="text-sm mb-0" style="color: #8898aa;">T·ªïng doanh thu & bi·ªÉu ƒë·ªì</p>
                </div>
                <div style="min-width: 220px;" class="mt-3 mt-lg-0">
                  <p class="text-xs text-uppercase mb-1" style="color: #8898aa; letter-spacing: 0.5px;">T·ªïng Doanh Thu</p>
                  <h4 style="color: #2dce89; font-weight: 700; margin: 0;" id="total-revenue">{{ stats.revenue|floatformat:0 }} VNƒê</h4>
                  <script>
                    // Format revenue with thousand separators (Vietnamese style)
                    document.addEventListener('DOMContentLoaded', function() {
                      const revenueEl = document.getElementById('total-revenue');
                      if (revenueEl) {
                        const revenue = {{ stats.revenue|floatformat:0 }};
                        revenueEl.textContent = revenue.toLocaleString('vi-VN') + ' VNƒê';
                      }
                    });
                  </script>
                </div>
              </div>
              <div class="card-body p-4">
                <div class="row g-4">
                  <div class="col-lg-8">
                    <div style="height: 320px;">
                      <canvas id="revenue-line-chart"></canvas>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div style="height: 320px;">
                      <canvas id="revenue-bar-chart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Model Management Section (optional, can be toggled) -->
        {% if app_list %}
          <div class="row mt-4" id="app-management-container" style="display: none;">
            <div class="col-12">
              <div class="card" id="app-list-card">
                <div class="card-header pb-0 d-flex justify-content-between align-items-center">
                  <h6 id="app-list-title">{% trans "Qu·∫£n l√Ω ·ª©ng d·ª•ng" %}</h6>
                  <button id="back-to-list" class="btn btn-sm btn-outline-primary" style="display: none;" onclick="showAppList()">
                    <i class="ni ni-bold-left"></i> Quay l·∫°i
                  </button>
                </div>
                <div class="card-body px-0 pt-0 pb-2" id="app-list-body">
                  <div class="table-responsive p-0">
                    <table class="table align-items-center mb-0">
                      <thead>
                        <tr>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">{% trans "·ª®ng d·ª•ng" %}</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">{% trans "S·ªë Model" %}</th>
                          <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">{% trans "H√†nh ƒë·ªông" %}</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for app in app_list %}
                          {% if app.models %}
                            <tr>
                              <td>
                                <div class="d-flex px-2 py-1">
                                  <div class="d-flex flex-column justify-content-center">
                                    <h6 class="mb-0 text-sm">{{ app.name }}</h6>
                                  </div>
                                </div>
                              </td>
                              <td>
                                <p class="text-sm font-weight-bold mb-0">{{ app.models|length }}</p>
                              </td>
                              <td>
                                <div>
                                  {% for model in app.models %}
                                    {% if model.admin_url %}
                                      <a href="{{ model.admin_url }}" class="badge badge-sm bg-gradient-info model-link" data-url="{{ model.admin_url }}" data-title="{{ model.name }}">{{ model.name }}</a>
                                    {% endif %}
                                  {% endfor %}
                                </div>
                              </td>
                            </tr>
                          {% endif %}
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'argon-dashboard-master/assets/js/argon-dashboard.min.js' %}"></script>
  <script src="{% static 'argon-dashboard-master/assets/js/popper.min.js' %}"></script>
  
  <script>
    // Initialize revenue charts with real monthly data from backend
    window.revenueMonthlyData = {{ monthly_revenue_json|safe }};
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (window.Chart) {
        const lineCanvas = document.getElementById('revenue-line-chart');
        const barCanvas = document.getElementById('revenue-bar-chart');
        
        let labels = ['Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','Jan'];
        let lineData = [40, 30, 120, 260, 500, 280, 400, 260, 480, 520];
        let barData = [12, 18, 9, 14, 22, 17, 19, 15, 23, 28];
        
        // Use real data from backend if available
        if (window.revenueMonthlyData) {
          labels = window.revenueMonthlyData.labels;
          lineData = window.revenueMonthlyData.lineData;
          barData = window.revenueMonthlyData.barData;
        }

        if (lineCanvas) {
          const ctx = lineCanvas.getContext('2d');
          const gradient = ctx.createLinearGradient(0, 0, 0, lineCanvas.height);
          gradient.addColorStop(0, 'rgba(86, 108, 255, 0.3)');
          gradient.addColorStop(1, 'rgba(86, 108, 255, 0.05)');

          new Chart(ctx, {
            type: 'line',
            data: {
              labels,
              datasets: [{
                label: 'Doanh thu',
                data: lineData,
                fill: true,
                backgroundColor: gradient,
                borderColor: '#566cff',
                borderWidth: 3,
                tension: 0.35,
                pointRadius: 0,
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: { mode: 'index', intersect: false }
              },
              scales: {
                x: { grid: { display: false }, ticks: { color: '#9ca3af', font: { size: 12 } } },
                y: { 
                  grid: { color: '#e5e7eb', borderDash: [4, 4] },
                  title: {
                    display: true,
                    text: 'VND',
                    color: '#9ca3af',
                    font: { size: 12, weight: 'bold' }
                  },
                  ticks: { 
                    color: '#9ca3af', 
                    font: { size: 12 },
                    callback: function(value) {
                      return value.toLocaleString('vi-VN');
                    }
                  } 
                }
              }
            }
          });
        }

        if (barCanvas) {
          const ctxBar = barCanvas.getContext('2d');
          const barGradient = ctxBar.createLinearGradient(0, 0, 0, barCanvas.height);
          barGradient.addColorStop(0, 'rgba(45, 206, 137, 0.9)');
          barGradient.addColorStop(1, 'rgba(17, 205, 239, 0.6)');

          new Chart(ctxBar, {
            type: 'bar',
            data: {
              labels,
              datasets: [{
                label: 'Doanh thu theo th√°ng',
                data: barData,
                backgroundColor: barGradient,
                borderRadius: 6,
                borderSkipped: false
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: { mode: 'index', intersect: false }
              },
              scales: {
                x: { grid: { display: false }, ticks: { color: '#9ca3af', font: { size: 12 } } },
                y: { 
                  grid: { color: '#e5e7eb', borderDash: [4, 4] },
                  title: {
                    display: true,
                    text: 'Bookings',
                    color: '#9ca3af',
                    font: { size: 12, weight: 'bold' }
                  },
                  ticks: { 
                    color: '#9ca3af', 
                    font: { size: 12 },
                    callback: function(value) {
                      return value;
                    }
                  } 
                }
              }
            }
          });
        }
      }
    });
  </script>
  
  <script>
    // Store original content
    let originalContent = null;
    
    // Handle model link clicks
    document.addEventListener('DOMContentLoaded', function() {
      const modelLinks = document.querySelectorAll('.model-link');
      
      modelLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          loadModelContent(this.dataset.url, this.dataset.title);
        });
      });

      // Intercept sidebar nav links to load inline instead of full page
      const sidebarLinks = document.querySelectorAll('#sidenav-main a.nav-link, #sidenav-main .nav-item a');
      sidebarLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          const href = this.getAttribute('href') || '';
          // Allow logout/change password/home to proceed normally
          if (!href.startsWith('/admin/')) return;
          if (href.includes('logout') || href.includes('password_change') || href.endsWith('/admin/')) return;
          e.preventDefault();
          const title = (this.textContent || '').trim() || 'Danh s√°ch';
          loadModelContent(href, title);
        });
      });
    });
    
    function loadModelContent(url, title) {
      const cardBody = document.getElementById('app-list-body');
      const cardTitle = document.getElementById('app-list-title');
      const backButton = document.getElementById('back-to-list');
      
      // Store original content if not already stored
      if (!originalContent) {
        originalContent = {
          body: cardBody.innerHTML,
          title: cardTitle.innerHTML
        };
      }
      
      // Show loading with custom spinner
      cardBody.innerHTML = `
        <div class="loading-container fade-in text-center">
          <div class="custom-spinner"></div>
          <p class="mt-4 mb-2" style="font-weight: 600; font-size: 15px;">ƒêang t·∫£i d·ªØ li·ªáu...</p>
          <p class="text-xs" style="color: #8898aa;">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
        </div>
      `;
      
      // Update title and show back button
      cardTitle.innerHTML = title;
      backButton.style.display = 'block';
      
      // Fetch content
      fetch(url)
        .then(response => response.text())
        .then(html => {
          // Parse the HTML
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // Extract main content (changelist or changeform)
          const content = doc.querySelector('#content-main, #content, .main-content');
          
          if (content) {
            // Wrap content with proper styling and animation
            cardBody.innerHTML = `
              <div class="inline-content fade-in" style="min-height: 400px;">
                ${content.innerHTML}
              </div>
            `;
            
            // Smooth scroll to top of card
            document.getElementById('app-list-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Reset checkbox initialization flag for new content
            const newInlineContent = document.querySelector('.inline-content');
            if (newInlineContent) {
              newInlineContent.removeAttribute('data-checkboxes-initialized');
            }
            
            // Re-initialize any scripts needed
            initializeInlineScripts();
          } else {
            cardBody.innerHTML = `
              <div class="fade-in">
                <div class="alert alert-warning m-4 d-flex align-items-center" role="alert" style="border-left: 4px solid #fb6340;">
                  <i class="ni ni-bell-55 text-warning me-3" style="font-size: 24px;"></i>
                  <div>
                    <strong>Kh√¥ng th·ªÉ t·∫£i n·ªôi dung</strong><br>
                    <a href="${url}" class="alert-link">Click ƒë·ªÉ m·ªü trong trang m·ªõi</a>
                  </div>
                </div>
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error loading content:', error);
          cardBody.innerHTML = `
            <div class="fade-in">
              <div class="alert alert-danger m-4 d-flex align-items-center" role="alert" style="border-left: 4px solid #f5365c;">
                <i class="ni ni-fat-remove text-danger me-3" style="font-size: 24px;"></i>
                <div>
                  <strong>C√≥ l·ªói x·∫£y ra!</strong><br>
                  <span class="text-sm">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu. <a href="${url}" class="alert-link">Click ƒë·ªÉ m·ªü trong trang m·ªõi</a></span>
                </div>
              </div>
            </div>
          `;
        });
    }
    
    function showAppList() {
      const cardBody = document.getElementById('app-list-body');
      const cardTitle = document.getElementById('app-list-title');
      const backButton = document.getElementById('back-to-list');
      
      if (originalContent) {
        // Add fade effect
        cardBody.style.opacity = '0';
        setTimeout(() => {
          cardBody.innerHTML = originalContent.body;
          cardTitle.innerHTML = originalContent.title;
          backButton.style.display = 'none';
          cardBody.style.opacity = '1';
          cardBody.style.transition = 'opacity 0.3s ease';
          
          // Smooth scroll
          document.getElementById('app-list-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
          
          // Re-attach event listeners
          const modelLinks = document.querySelectorAll('.model-link');
          modelLinks.forEach(link => {
            link.addEventListener('click', function(e) {
              e.preventDefault();
              loadModelContent(this.dataset.url, this.dataset.title);
            });
          });
        }, 150);
      }
    }
    
    function initializeInlineScripts() {
      // Initialize any Django admin scripts needed for inline content
      if (typeof django !== 'undefined' && django.jQuery) {
        django.jQuery(document).trigger('formset:added');
      }
      
      // Use event delegation for checkbox handling - attach to inline-content container
      const inlineContent = document.querySelector('.inline-content');
      
      if (inlineContent && !inlineContent.hasAttribute('data-checkboxes-initialized')) {
        inlineContent.setAttribute('data-checkboxes-initialized', 'true');
        
        inlineContent.addEventListener('change', function(e) {
          // Handle select all checkbox
          if (e.target.id === 'action-toggle') {
            const checkboxes = this.querySelectorAll('.action-select');
            checkboxes.forEach(cb => {
              cb.checked = e.target.checked;
            });
          }
          // Handle individual checkbox changes
          else if (e.target.classList.contains('action-select')) {
            const selectAllCb = this.querySelector('#action-toggle');
            const checkboxes = this.querySelectorAll('.action-select');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const someChecked = Array.from(checkboxes).some(cb => cb.checked);
            
            if (selectAllCb) {
              selectAllCb.checked = allChecked;
              selectAllCb.indeterminate = someChecked && !allChecked;
            }
          }
        });
      } else if (inlineContent) {
        // If inline-content already has the listener, just remove and re-attach the flag
        inlineContent.removeAttribute('data-checkboxes-initialized');
        
        // Re-attach by recursively calling initializeInlineScripts
        const newInlineContent = document.querySelector('.inline-content');
        if (newInlineContent && !newInlineContent.hasAttribute('data-checkboxes-initialized')) {
          setTimeout(() => initializeInlineScripts(), 0);
          return;
        }
      }
      
      // Handle delete action - let it submit normally (Django handles it)
      const actionForms = document.querySelectorAll('.inline-content #changelist-form');
      actionForms.forEach(form => {
        if (!form.hasAttribute('data-actions-handled')) {
          form.setAttribute('data-actions-handled', 'true');
          
          // Only intercept submit if it's the changelist form with actions
          const actionSelect = form.querySelector('select[name="action"]');
          if (actionSelect) {
            // Let the form submit normally for delete_selected action
            // Don't prevent default
          }
        }
      });
      
      // Intercept clicks on changelist item links (e.g., tour links in the table)
      const changeLinks = document.querySelectorAll('.inline-content #result_list a[href*="/change/"]');
      changeLinks.forEach(link => {
        if (!link.hasAttribute('data-link-listener')) {
          link.setAttribute('data-link-listener', 'true');
          link.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const url = this.href;
            const title = this.textContent.trim();
            
            loadModelContent(url, title);
          });
        }
      });
      
      // Handle form submissions - intercept all submit buttons
      const allForms = document.querySelectorAll('.inline-content form');
      allForms.forEach(form => {
        if (!form.hasAttribute('data-form-handled')) {
          form.setAttribute('data-form-handled', 'true');
          
          // Check if this is a changelist form with actions
          const actionSelect = form.querySelector('select[name="action"]');
          const isActionForm = actionSelect !== null;
          
          if (isActionForm) {
            // For delete actions, submit normally
            const submitButtons = form.querySelectorAll('button[type="submit"], input[type="submit"]');
            submitButtons.forEach(btn => {
              if (!btn.hasAttribute('data-submit-listener')) {
                btn.setAttribute('data-submit-listener', 'true');
                btn.addEventListener('click', function(e) {
                  const selectedAction = actionSelect.value;
                  const selectedCount = form.querySelectorAll('input[type="checkbox"][name="_selected_action"]:checked').length;
                  
                  // If delete_selected is chosen, show confirmation
                  if (selectedAction === 'delete_selected' && selectedCount > 0) {
                    if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ${selectedCount} tour n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!`)) {
                      // Submit the form normally - let Django handle it
                      form.submit();
                    } else {
                      e.preventDefault();
                    }
                  }
                });
              }
            });
          } else {
            // For change forms (individual edit), intercept with AJAX
            const submitButtons = form.querySelectorAll('input[type="submit"], button[type="submit"]');
            submitButtons.forEach(btn => {
              if (!btn.hasAttribute('data-submit-listener')) {
                btn.setAttribute('data-submit-listener', 'true');
                btn.addEventListener('click', function(e) {
                  // Determine which button was clicked
                  const buttonName = this.name;
                  
                  // Check if it's a save button (ignore delete, etc)
                  if (buttonName === '_save' || buttonName === '_continue') {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    submitFormViaAjax(form, this);
                  }
                });
              }
            });
          }
        }
      });
    }
    
    function submitFormViaAjax(form, submitButton) {
      const cardBody = document.getElementById('app-list-body');
      const originalContent = cardBody.innerHTML;
      const actionUrl = form.action;
      const formData = new FormData(form);
      
      // Add the clicked button to formData
      if (submitButton && submitButton.name) {
        formData.append(submitButton.name, submitButton.value);
      }
      
      // Show loading
      cardBody.innerHTML = `
        <div class="loading-container fade-in text-center">
          <div class="custom-spinner"></div>
          <p class="mt-4 mb-2" style="font-weight: 600; font-size: 15px;">ƒêang l∆∞u d·ªØ li·ªáu...</p>
          <p class="text-xs" style="color: #8898aa;">Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t</p>
        </div>
      `;
      
      // Submit form
      fetch(actionUrl, {
        method: 'POST',
        body: formData,
        credentials: 'same-origin'
      })
      .then(response => {
        // Check if response is a redirect (201, 302, etc)
        if (response.status >= 300 && response.status < 400) {
          // Success - redirect to changelist
          const changeListUrl = actionUrl.replace(/\/\d+\/change\/$/, '/');
          return fetch(changeListUrl, {
            credentials: 'same-origin'
          }).then(r => r.text()).then(html => {
            return { html, success: true };
          });
        }
        
        // Otherwise return the response
        return response.text().then(html => {
          return { html, success: response.status === 200 };
        });
      })
      .then(data => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.html, 'text/html');
        const content = doc.querySelector('#content-main, #content, .main-content');
        
        if (!content) {
          cardBody.innerHTML = originalContent;
          alert('Kh√¥ng th·ªÉ x·ª≠ l√Ω y√™u c·∫ßu');
          return;
        }
        
        // Wrap content
        const wrappedContent = `
          <div class="inline-content fade-in" style="min-height: 400px;">
            ${content.innerHTML}
          </div>
        `;
        
        if (data.success) {
          // Show success and then display the updated content
          cardBody.innerHTML = wrappedContent;
          
          const successAlert = document.createElement('div');
          successAlert.className = 'fade-in';
          successAlert.style.cssText = 'margin: 20px; padding: 16px 20px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border-left: 4px solid #2dce89; border-radius: 8px; box-shadow: 0 2px 8px rgba(45,206,137,0.2);';
          successAlert.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 32px; height: 32px; background: #2dce89; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="ni ni-check-bold" style="color: white; font-size: 16px;"></i>
              </div>
              <div style="flex: 1;">
                <strong style="color: #155724; font-size: 14px;">L∆∞u th√†nh c√¥ng!</strong>
                <p style="color: #155724; margin: 0; font-size: 13px;">D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.</p>
              </div>
              <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: #155724; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px;">&times;</button>
            </div>
          `;
          cardBody.insertBefore(successAlert, cardBody.firstChild);
          
          // Auto dismiss alert
          setTimeout(() => {
            if (successAlert.parentNode) {
              successAlert.style.opacity = '0';
              successAlert.style.transform = 'translateY(-10px)';
              successAlert.style.transition = 'all 0.3s ease';
              setTimeout(() => successAlert.remove(), 300);
            }
          }, 3000);
        } else {
          // Show the form again with errors
          cardBody.innerHTML = wrappedContent;
          
          const errorAlert = document.createElement('div');
          errorAlert.className = 'fade-in';
          errorAlert.style.cssText = 'margin: 20px; padding: 16px 20px; background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); border-left: 4px solid #f5365c; border-radius: 8px; box-shadow: 0 2px 8px rgba(245,54,92,0.2);';
          errorAlert.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 32px; height: 32px; background: #f5365c; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="ni ni-fat-remove" style="color: white; font-size: 16px;"></i>
              </div>
              <div style="flex: 1;">
                <strong style="color: #721c24; font-size: 14px;">C√≥ l·ªói!</strong>
                <p style="color: #721c24; margin: 0; font-size: 13px;">Vui l√≤ng ki·ªÉm tra c√°c tr∆∞·ªùng d∆∞·ªõi ƒë√¢y.</p>
              </div>
              <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: #721c24; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px;">&times;</button>
            </div>
          `;
          cardBody.insertBefore(errorAlert, cardBody.firstChild);
        }
        
        // Re-initialize
        initializeInlineScripts();
        
        // Scroll to top
        document.getElementById('app-list-card').scrollIntoView({ behavior: 'smooth', block: 'start' });
      })
      .catch(error => {
        console.error('Error:', error);
        cardBody.innerHTML = originalContent;
        alert('C√≥ l·ªói k·∫øt n·ªëi: ' + error.message);
      });
    }
    }
  </script>
</body>
</html>
