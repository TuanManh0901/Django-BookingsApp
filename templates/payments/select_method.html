{% extends 'base.html' %}
{% load humanize %}
{% load formatting %}
{% block title %}Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n{% endblock %}

{% block content %}
<!-- Threeland Hero - Payment -->
<div class="threeland-hero hero-short">
  {% load static %}
  <div class="hero-background-image" style="background-image: url('{% static 'images/phu_quoc_resort.png' %}');"></div>
  <div class="hero-overlay"></div>
  
  <div class="hero-main-content">
    <p class="hero-subtitle">BOOKING</p>
    <h1 class="hero-main-title">Thanh toÃ¡n Ä‘Æ¡n Ä‘áº·t tour</h1>
  </div>
</div>

<div class="container mt-4">

  {% if booking.deposit_required and not booking.deposit_paid %}
  <style>
    #deposit-banner-select, #deposit-banner-select * { color: #111 !important; }
  </style>
  <div id="deposit-banner-select" class="warning-box border-0" style="background: #fff4d8; border: 1px solid #f6d98f !important; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
    <strong>LÆ°u Ã½:</strong> ÄÆ¡n nÃ y yÃªu cáº§u cá»c {{ booking.deposit_percentage_display }}% (tá»©c <strong>{{ booking.deposit_amount|vn_intcomma }} VNÄ</strong>) trÆ°á»›c khi giá»¯ chá»—. Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c vÃ  thanh toÃ¡n cá»c.
  </div>
  {% endif %}

  {% if messages %} <div class="messages">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show text-dark" role="alert"
    >
      {{ message }} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
 <div class="row"> <div class="col-md-8"> <form action="{% url 'payments:process_payment' booking.id %}" method="POST">
        {% csrf_token %}

        <!-- Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n MoMo --> <div class="card mb-4"> <div class="card-header">
            <h5>ğŸ’³ Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n MoMo</h5>
          </div> <div class="card-body"> <div class="row"> <div class="col-md-6 mb-3"> <div class="form-check">
                  <input class="form-check-input" type="radio" name="momo_payment_type" id="momo_atm" value="ATM"
                    checked
                  /> <label class="form-check-label" for="momo_atm">
                    ğŸ§ Tháº» ATM
                  </label>
                </div>
              </div> <div class="col-md-6 mb-3"> <div class="form-check">
                  <input class="form-check-input" type="radio" name="momo_payment_type" id="momo_cc" value="CC"
                  /> <label class="form-check-label" for="momo_cc">
                    ğŸ’³ Tháº» Credit Card
                  </label>
                </div>
              </div> <div class="col-md-6 mb-3"> <div class="form-check">
                  <input class="form-check-input" type="radio" name="momo_payment_type" id="momo_wallet" value="WALLET"
                  /> <label class="form-check-label" for="momo_wallet">
                    ğŸ“± VÃ­ MoMo
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- NÃºt thanh toÃ¡n --> <div class="d-flex justify-content-between">
          <button type="submit" class="btn btn-success btn-lg" name="payment_method" value="momo"
          >
            ğŸ’³ Thanh toÃ¡n MoMo
          </button>
          {% if not booking.deposit_paid and booking.payment_status != 'paid' %}
          <button type="submit" class="btn btn-secondary btn-lg" name="payment_method" value="cod"
          >
            ğŸ’° Äáº·t cá»c giá»¯ chá»—
          </button>
          {% endif %}
        </div>
      </form>
    </div>
 <div class="col-md-4">
      <!-- ThÃ´ng tin Ä‘Æ¡n Ä‘áº·t tour --> <div class="card mb-3"> <div class="card-header">
          <h5>ğŸ“‹ ThÃ´ng tin Ä‘Æ¡n Ä‘áº·t tour</h5>
        </div> <div class="card-body">
            <p><strong>Tour:</strong> {{ booking.tour.name }}</p>
            <p><strong>NgÃ y khá»Ÿi hÃ nh:</strong> {{ booking.booking_date|vn_date }}</p>
            <p><strong>NgÆ°á»i lá»›n:</strong> {{ booking.num_adults }}</p>
            <p><strong>Tráº» em:</strong> {{ booking.num_children }}</p>
            <p><strong>Tá»•ng giÃ¡:</strong> {{ booking.total_price|vn_intcomma }} VNÄ</p>
            {% if booking.deposit_paid and booking.payment_status != 'paid' %}
            <p><strong>ÄÃ£ cá»c:</strong> <span class="text-success">{{ booking.deposit_amount|vn_intcomma }} VNÄ</span></p>
            <p><strong>CÃ²n láº¡i:</strong> <span class="text-danger fw-bold">{{ booking.get_remaining_amount|vn_intcomma }} VNÄ</span></p>
            {% endif %}
        </div>
      </div>

      <!-- TÃ³m táº¯t Ä‘Æ¡n hÃ ng --> <div class="card"> <div class="card-header">
          <h5>ğŸ“‹ TÃ³m táº¯t Ä‘Æ¡n hÃ ng</h5>
        </div> <div class="card-body"> 
          {% if booking.deposit_paid and booking.payment_status != 'paid' %}
          <div class="d-flex justify-content-between mb-2">
            <span>Tá»•ng tiá»n ban Ä‘áº§u:</span>
            <span class="text-muted text-decoration-line-through">{{ booking.total_price|vn_intcomma }} VNÄ</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>ÄÃ£ cá»c:</span>
            <span class="text-success">-{{ booking.deposit_amount|vn_intcomma }} VNÄ</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span class="fw-bold">CÃ²n pháº£i thanh toÃ¡n:</span>
            <span class="fw-bold text-danger fs-5">{{ booking.get_remaining_amount|vn_intcomma }} VNÄ</span>
          </div>
          {% else %}
          <div class="d-flex justify-content-between mb-2">
            <span>Tá»•ng tiá»n:</span>
            <span><strong>{{ booking.total_price|vn_intcomma }} VNÄ</strong></span>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
 <div class="mt-3"> <a href="{% url 'booking_detail' booking.pk %}" class="btn btn-secondary"> <i class="fas fa-arrow-left"></i> Quay láº¡i Ä‘Æ¡n Ä‘áº·t tour
    </a>
  </div>
</div>
{% endblock %}
