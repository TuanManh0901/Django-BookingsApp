{% extends 'base.html' %}
{% load formatting %}
{% block title %}
T√¨m Ki·∫øm Tours - VN Travel
{% endblock %}

{% block content %}
<!-- Threeland-Style Hero -->
<div class="threeland-hero" style="min-height: 55vh;">
  <!-- Background Image -->
  {% load static %}
  <div class="hero-background-image" style="background-image: url('{% static 'images/ha_long_bay.png' %}');"></div>
  <div class="hero-overlay"></div>
  
  <!-- Hero Content -->
  <div class="hero-main-content">
    <div class="container text-center">
      <p class="hero-subtitle" data-aos="fade-up" style="color: white; font-size: 1rem; margin-bottom: 1rem; opacity: 0.9;">Kh√°m Ph√°</p>
      <h1 class="hero-main-title" data-aos="fade-up" data-aos-delay="100">
        {% if search_query %}
          K·∫øt Qu·∫£ T√¨m Ki·∫øm
        {% else %}
          C√°c tour du l·ªãch t·∫°i Vi·ªát Nam
        {% endif %}
      </h1>
      {% if search_query %}
        <p class="hero-search-query" data-aos="fade-up" data-aos-delay="150" style="color: white; font-size: 1.2rem; opacity: 0.9;">"{{ search_query }}"</p>
      {% endif %}
      <a href="{% url 'ai_chatbot:chat' %}" class="btn-plan-trip" data-aos="fade-up" data-aos-delay="200">
        Nh·∫≠n T∆∞ V·∫•n Mi·ªÖn Ph√≠
      </a>
    </div>
  </div>
  
  <!-- Search Bar at Bottom -->
  <div class="hero-search-bottom">
    <div class="container-fluid px-4">
      <form action="{% url 'search_tours' %}" method="GET" class="search-form-bottom">
        <div class="search-fields-row">
          <!-- Duration -->
          <div class="search-field-item">
            <i class="ni ni-calendar-grid-58"></i>
            <select name="duration" class="form-select-transparent">
              <option value="">Th·ªùi Gian</option>
              {% for dur in durations %}
                <option value="{{ dur }}" {% if selected_duration == dur|stringformat:"s" %}selected{% endif %}>{{ dur }} ng√†y</option>
              {% endfor %}
            </select>
          </div>
          
          <!-- Location -->
          <div class="search-field-item">
            <i class="ni ni-world-2"></i>
            <select name="location" class="form-select-transparent">
              <option value="">ƒêi·ªÉm ƒê·∫øn</option>
              {% for loc in locations %}
                <option value="{{ loc }}" {% if selected_location == loc %}selected{% endif %}>{{ loc }}</option>
              {% endfor %}
            </select>
          </div>
          
          <!-- Search Input -->
          <div class="search-field-item search-input-field">
            <i class="ni ni-zoom-split-in"></i>
            <input type="text" name="q" placeholder="T√¨m ki·∫øm..." class="form-control-transparent" value="{{ search_query }}">
          </div>
          
          <!-- Search Button -->
          <button type="submit" class="btn-search-bottom">
            T√¨m Ki·∫øm <i class="ni ni-bold-right"></i>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Tours Grid -->
<div class="container mt-5">
  <div class="row">
    {% if tours %}
      {% for tour in tours %}
      <div class="col-lg-4 col-md-6 mb-4" data-aos="fade-up" data-aos-delay="{{ forloop.counter|add:'-1'|divisibleby:3|yesno:'0,100,200' }}">
        <div class="premium-tour-card">
          <div class="card-image-wrapper">
            {% if tour.images.all %}
              {% load tour_tags %}
              <img src="{% tour_image_url tour.images.first %}" alt="{{ tour.name }}" />
            {% else %}
              {% load static %}
              <img src="{% static tour.get_fallback_image %}" alt="{{ tour.name }}" />
            {% endif %}
            <div class="image-overlay"></div>
            
            
            <!-- Hot & Limited Badges (Top-Left) -->
            <div class="card-badges">
              {% if tour.is_hot %}
                <span class="badge-hot">üî• Hot</span>
              {% endif %}
              {% if tour.get_available_seats <= 5 and tour.get_available_seats > 0 %}
                <span class="badge-limited">‚ö° S·∫Øp h·∫øt ch·ªó</span>
              {% endif %}
            </div>
            
            <!-- Weather Badge (Top-Right) -->
            {% if tour.weather_data %}
            <div class="weather-badge-top-right">
              <span class="weather-icon-large">{{ tour.weather_emoji }}</span>
              <span class="weather-temp-large">{{ tour.weather_data.temp }}¬∞</span>
            </div>
            {% endif %}

          </div>
          
          <div class="card-body">
            <h5 class="card-title">{{ tour.name }}</h5>
            
            <div class="tour-rating">
              <span class="stars">
                {% with avg_rating=tour.get_average_rating %}
                  {% for i in "12345" %}
                    {% if i|add:"0" <= avg_rating %}‚≠ê{% endif %}
                  {% endfor %}
                  {% if avg_rating == 0 %}‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê{% endif %}
                {% endwith %}
              </span>
              <span class="rating-text">({{ tour.reviews.count }} ƒë√°nh gi√°)</span>
            </div>
            
            <p class="card-text">{{ tour.description|truncatechars:80 }}</p>
            
            <div class="tour-details">
              <div class="tour-detail-item">
                <i class="ni ni-pin-3"></i>
                <span>{{ tour.location }}</span>
              </div>
              <div class="tour-detail-item">
                <i class="ni ni-time-alarm"></i>
                <span>{{ tour.duration }} ng√†y</span>
              </div>
              <div class="tour-detail-item">
                <i class="ni ni-circle-08"></i>
                <span>{{ tour.get_available_seats }}/{{ tour.max_people }} ch·ªó</span>
              </div>
            </div>
            
            <div class="tour-price">
              <span class="price-label">T·ª´</span>
              <span class="price-amount">{{ tour.price|vn_intcomma }}</span>
              <span class="price-label">VNƒê</span>
            </div>
            
            <a href="{% url 'tour_detail' tour.pk %}" class="btn btn-primary w-100">
              <i class="ni ni-spaceship"></i> Xem Chi Ti·∫øt
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="text-center py-5">
          <i class="ni ni-compass-04" style="font-size: 5rem; color: #dfe6e9;"></i>
          <h3 class="mt-4">Kh√¥ng t√¨m th·∫•y tour n√†o</h3>
          <p class="text-muted">Vui l√≤ng th·ª≠ l·∫°i v·ªõi c√°c ti√™u ch√≠ kh√°c</p>
          <a href="{% url 'search_tours' %}" class="btn btn-primary mt-3">
            <i class="ni ni-bold-left"></i> Xem t·∫•t c·∫£ tours
          </a>
        </div>
      </div>
    {% endif %}
  </div>
  
  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <div class="row mt-5">
    <div class="col-12">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center pagination-premium-soft">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_location %}&location={{ selected_location }}{% endif %}{% if selected_duration %}&duration={{ selected_duration }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if selected_sort %}&sort_by={{ selected_sort }}{% endif %}" aria-label="Previous">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
          {% else %}
             <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-left"></i></span>
            </li>
          {% endif %}
          
          <li class="page-item active">
            <span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
          </li>
          
          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_location %}&location={{ selected_location }}{% endif %}{% if selected_duration %}&duration={{ selected_duration }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if selected_sort %}&sort_by={{ selected_sort }}{% endif %}" aria-label="Next">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-right"></i></span>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
  {% endif %}
</div>

<style>
/* Threeland Hero Styles */
.threeland-hero {
  position: relative;
  min-height: 55vh;
  overflow: hidden;
}

.hero-background-image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: -1;
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}

.hero-main-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  text-align: center;
  width: 100%;
}

.hero-main-title {
  font-size: 3rem;
  font-weight: 700;
  color: white;
  margin-bottom: 1.5rem;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  line-height: 1.3;
}

.btn-plan-trip {
  display: inline-block;
  padding: 1rem 2.5rem;
  background: transparent;
  border: 2px solid white;
  color: white;
  font-size: 1rem;
  font-weight: 600;
  text-decoration: none;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.btn-plan-trip:hover {
  background: white;
  color: #2d3436;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
}

.hero-search-bottom {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 10;
  padding: 2rem 0;
}

.search-form-bottom {
  background: white;
  border-radius: 4px;
  padding: 1rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.search-fields-row {
  display: flex;
  gap: 0;
  align-items: center;
}

.search-field-item {
  flex: 1;
  display: flex;
  align-items: center;
  padding: 0.75rem 1.5rem;
  border-right: 1px solid #e0e0e0;
}

.search-field-item:last-of-type {
  border-right: none;
}

.search-field-item i {
  color: #667eea;
  margin-right: 0.75rem;
  font-size: 1.2rem;
}

.form-select-transparent,
.form-control-transparent {
  border: none;
  outline: none;
  background: transparent;
  font-size: 1rem;
  color: #2d3436;
  width: 100%;
}

.form-select-transparent:focus,
.form-control-transparent:focus {
  outline: none;
  box-shadow: none;
}

.form-control-transparent::placeholder {
  color: #95a5a6;
}

.search-input-field {
  flex: 1.5;
}

.btn-search-bottom {
  background: #667eea;
  color: white;
  border: none;
  padding: 1rem 2.5rem;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.btn-search-bottom:hover {
  background: #5568d3;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

@media (max-width: 992px) {
  .search-fields-row {
    flex-direction: column;
  }
  
  .search-field-item {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .btn-search-bottom {
    width: 100%;
    justify-content: center;
  }
  
  .hero-main-title {
    font-size: 2rem;
  }
}
</style>

<!-- AOS Library -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<script>
  AOS.init({
    duration: 600,
    easing: 'ease-out',
    once: true
  });
</script>

{% endblock %}
